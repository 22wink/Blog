import{_ as ve,u as fe,K as pe,an as he,B as f,L as R,I as me,aJ as B,bj as ge,af as ke,r as ye,c as _,a as t,b as o,l as i,e as c,d as O,F as H,J as P,t as d,n as be,bk as xe,H as we,v as Ce,o as l,bl as Le,q as U,bm as Ie,f as F,h as G,bn as Me,bo as Te,k as V,z as g,j as Ee,aP as Se,bp as ze,bq as Be,br as J,az as He,x as Ve,y as qe,aq as C,T as L,aQ as W,b8 as Ae,aI as K,aL as $e,p as je,G as Ne,Y as De,E as Re,aA as Oe}from"./index-7cf17b50.js";import{E as Pe}from"./el-skeleton-item-7b233842.js";import{g as Ue,a as Fe,c as Ge,l as Je,d as We}from"./message-49d65dd6.js";import{c as Ke,a as Qe}from"./like-f669dd3b.js";const q=k=>(Ve("data-v-0a2a8190"),k=k(),qe(),k),Xe={class:"message-header"},Ye=q(()=>t("div",{class:"message-title"},"留言板",-1)),Ze={class:"flex items-center !h-[5rem]"},es={class:"flex items-center"},ss={class:"message-body center_box"},ts=["onClick"],as={class:"tab"},os=["onClick"],ls={key:0,class:"!py-[5px] flex justify-center items-center"},ns=q(()=>t("div",{class:"loading"},[t("div",{class:"coffee_cup"})],-1)),is={key:0,class:"img-loading"},cs={class:"top-header"},rs={class:"flex items-center"},_s={class:"nick-name"},ds={key:0,class:"flex items-center cursor-pointer option-top"},us=["innerHTML"],vs={class:"bottom"},fs={class:"left flex items-center"},ps={class:"time"},hs=["onClick"],ms=q(()=>t("span",null,"评论",-1)),gs={class:"!ml-[5px]"},ks={class:"index-tag"},ys={class:"flex justify-start items-center option"},bs=["onClick"],xs={class:"observer"},ws={__name:"index",setup(k){const I=fe(),Q=pe(),{getUserInfo:u}=he(Q),r=f([]),M=f(0),y=f(!1),T=f(!1);let v,m;const n=R({current:1,size:8,tag:"",message:"",user_id:u.value.id}),X=R({...n}),A=f(0),b=f([]),E=f(!1),S=f(""),Y=(s,a)=>{A.value=s,n.tag=a,S.value="",a=="全部"&&(n.tag=""),n.current=1,h()},Z=()=>{m=document.querySelector(".observer"),v=new IntersectionObserver(s=>{s.forEach(async a=>{a.isIntersecting&&a.intersectionRatio>0&&M.value>r.value.length&&!y.value&&(n.current++,h())})},{rootMargin:"0px 0px 300px 0px"}),m&&v.observe(m)},h=async()=>{n.current==1?y.value=!0:T.value=!0;try{let s=await Ue(n);if(s.code==0){const{list:a}=s.result;r.value=n.current==1?s.result.list:r.value.concat(s.result.list);let p=s.result.list.map((N,x)=>".message"+(r.value.length-a.length+x));M.value=s.result.total,be(()=>{xe(p,0,1.2)})}}finally{y.value=!1,T.value=!1}},ee=async(s,a)=>{s.is_like?(await Ge(s.id)).code==0&&(u.value.id&&await Ke({for_id:s.id,type:3,user_id:u.value.id}),r.value[a].like_times--,r.value[a].is_like=!1,C({offset:60,title:"提示",message:L("div",{style:"color: #7ec050; font-weight: 600;"},"已取消点赞")})):(await Je(s.id)).code==0&&(u.value.id&&await Qe({for_id:s.id,type:3,user_id:u.value.id}),r.value[a].like_times++,r.value[a].is_like=!0,C({offset:60,title:"提示",message:L("div",{style:"color: #7ec050; font-weight: 600;"},"点赞成功")}))},se=s=>{s&&W("blog-message-item",s),I.push({path:"/message/detail"})},te=s=>{s&&W("blog-message-item",s),I.push({path:"/message/publish",query:{type:"edit"}})},$=()=>{I.push({path:"/message/publish",query:{type:"add"}})},ae=s=>{Ae.confirm("确认删除留言吗","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then(async()=>{const a=await We(s.id);a&&a.code==0?(C({offset:60,title:"提示",message:L("div",{style:"color: #7ec050; font-weight: 600;"},"删除成功")}),v&&v.unobserve(m),v=null,n.current=1,h()):C({offset:60,title:"错误提示",message:L("div",{style:"color: #f56c6c; font-weight: 600;"},a.message)})})},j=async()=>{b.value=[];const s=await Fe();s.code==0&&(b.value=Array.isArray(s.result)?s.result.map((a,p)=>({key:p+1,label:a.tag})):[],b.value.unshift({key:0,label:"全部"}))},oe=()=>{E.value=!0},le=()=>{E.value=!1},ne=s=>{n.message=s,h()};return me(async()=>{B("message-refresh"),await j(),await h(),Z()}),ge(async()=>{K("message-refresh")&&(Object.assign(n,X),await j(),await h(),B("message-refresh")),K("message-need-scroll")&&(window.scrollTo({top:0,behavior:"smooth"}),B("message-need-scroll"))}),ke(()=>{v&&v.unobserve(m),v=null}),(s,a)=>{const p=we,N=$e,x=je,ie=Ne,D=De,ce=Re,re=Pe,_e=Ce,de=Oe,ue=ye("image");return l(),_("div",{class:"message !min-h-[60vh]",onClick:le},[t("div",Xe,[Ye,t("div",Ze,[o(i(Le),{size:"1.2rem",typeList:["生活原本沉闷，但跑起来就会有风!"]})]),t("div",es,[t("span",{class:"apply-button !mr-[20px]",onClick:$},"一定要留下点什么～"),o(p,{placement:"top-start",width:110,trigger:"hover",content:"点我去发表留言"},{reference:c(()=>[o(U,{name:"publish",width:2,height:2,onClick:$})]),_:1})])]),t("div",ss,[o(_e,{class:"row-height",gutter:16},{default:c(()=>[o(x,{span:24},{default:c(()=>[t("div",{class:"search-tab",onClick:Ie(oe,["stop"])},[t("ul",as,[(l(!0),_(H,null,F(b.value,e=>(l(),_("li",{key:e.key,onClick:w=>Y(e.key,e.label)},[t("div",{class:G([e.key==A.value?"message-active-tab":"","tab-li"])},d(e.label),3)],8,os))),128))]),o(Me,{duration:{enter:0,leave:500},"enter-active-class":"animate__animated animate__fadeIn","leave-active-class":"animate__animated animate__fadeOut"},{default:c(()=>[E.value?(l(),_("div",ls,[o(N,{"prefix-icon":i(Te),class:"search",modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value=e),placeholder:"搜索留言内容",onChange:ne,clearable:""},null,8,["prefix-icon","modelValue"])])):V("",!0)]),_:1})],8,ts)]),_:1}),o(re,{loading:y.value,style:{height:"100%"},animated:""},{template:c(()=>[ns]),default:c(()=>[(l(!0),_(H,null,F(r.value,(e,w)=>(l(),O(x,{class:G("message"+w),xs:24,sm:12,key:w},{default:c(()=>[o(ce,{class:"card-hover"},{default:c(()=>[t("div",{style:g({backgroundColor:e.bg_color}),class:"message-card animate__animated animate__fadeIn"},[e.bg_url?Ee((l(),_("div",is,null,512)),[[ue,e.bg_url]]):V("",!0),t("div",{class:"top",style:g({backgroundImage:e.bg_url?`url(${e.bg_url})`:""})},[t("div",cs,[t("div",rs,[o(ie,{class:"left-avatar",src:e.avatar},{default:c(()=>[P(d(e.nick_name),1)]),_:2},1032,["src"]),t("span",_s,d(e.nick_name),1)]),i(u).id&&i(u).id==e.user_id||i(u).role==1?(l(),_("div",ds,[o(D,{onClick:z=>te(e)},{default:c(()=>[o(i(Se))]),_:2},1032,["onClick"]),o(D,{class:"!ml-[10px]",onClick:z=>ae(e)},{default:c(()=>[o(i(ze))]),_:2},1032,["onClick"])])):V("",!0)]),i(Be)(i(J)(e.message))?(l(),_("div",{key:0,innerHTML:i(J)(e.message),style:g({color:e.color,fontSize:e.font_size+"px",fontWeight:e.font_weight})},null,12,us)):(l(),_("div",{key:1,style:g({color:e.color,fontSize:e.font_size+"px",fontWeight:e.font_weight})},d(e.message),5))],4),t("div",vs,[t("div",fs,[t("div",ps,d(i(He)(e.createdAt))+"前",1),t("div",{class:"message-comment cursor-pointer !mr-[10px]",onClick:z=>se(e)},[ms,t("span",gs,d(e.comment_total),1)],8,hs),t("div",ks,"#"+d(e.tag),1)]),t("div",ys,[t("div",{class:"cursor-pointer scale flex items-center",onClick:z=>ee(e,w)},[o(U,{name:e.is_like?"redHeart":"greyHeart",width:1.5},null,8,["name"]),t("span",{style:g({color:e.is_like?"#f00":""}),class:"!ml-[5px]"},d(e.like_times||0),5)],8,bs)])])],4)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1},8,["loading"])]),_:1}),t("div",xs,[T.value?(l(),O(de,{key:0,size:32})):(l(),_(H,{key:1},[P(d(r.value.length>=M.value?"已经到底了~":"下拉加载更多～"),1)],64))])])])}}},Ts=ve(ws,[["__scopeId","data-v-0a2a8190"]]);export{Ts as default};
