import{a2 as R,_ as G,B as m,W as pe,w as N,n as fe,o as l,c as u,a as r,t as C,z as D,A as me,k,I as Y,h as z,l as L,b as B,bJ as _e,e as H,J as O,bF as ve,aN as he,K,L as F,F as V,f as Z,d as E,aA as ee,aq as I,T as b,b8 as te,G as W,x as se,y as ae,bq as ye,m as ge}from"./index-7cf17b50.js";import{P as ke}from"./pagination-488bf88a.js";import{c as ne,a as oe}from"./like-f669dd3b.js";const we=e=>new Promise((c,d)=>{R.post("/api/comment/add",e).then(t=>{c(t)})}),le=e=>new Promise((c,d)=>{R.post("/api/comment/apply",e).then(t=>{c(t)})}),re=e=>new Promise((c,d)=>{R.put("/api/comment/thumbUp/"+e,{}).then(t=>{c(t)})}),ie=e=>new Promise((c,d)=>{R.put("/api/comment/cancelThumbUp/"+e,{}).then(t=>{c(t)})}),ce=(e,c=0)=>new Promise((d,t)=>{R.delete(`/api/comment/delete/${e}/${c}`,{}).then(n=>{d(n)})}),Ie=e=>new Promise((c,d)=>{R.post("/api/comment/frontGetParentComment",e).then(t=>{c(t)})}),be=e=>new Promise((c,d)=>{R.post("/api/comment/frontGetChildrenComment",e).then(t=>{c(t)})}),xe=e=>new Promise((c,d)=>{R.post("/api/comment/getCommentTotal",e).then(t=>{c(t)})});function X(){var e;if(window.getSelection)return e=window.getSelection(),e.focusOffset;if(document.selection)return e=document.selection.createRange(),e.focusOffset}function q(e){let c=0;switch(e){case"article":c=1;break;case"talk":c=2;break;case"message":c=3;break;case"comment":c=4}return c}const Ce=["title"],Te={__name:"index",props:{text:{type:String,default:""},maxLines:{type:Number,default:3},width:{type:Number,default:0},color:{String,default:""},fontSize:{type:Number,default:14}},setup(e){const c=e,d=m(!1),t=m(!1),n=m(null),p=m(null),i=m(null),_=pe(()=>({color:c.color,fontSize:c.fontSize+"px",whiteSpace:"pre-line",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":d.value?"unset":c.maxLines}));function h(){t.value=i.value.scrollHeight>i.value.clientHeight}function T(){d.value=!d.value}return N(()=>{c.text},()=>fe(()=>{h()}),{immediate:!0}),(v,S)=>(l(),u("div",{class:"text-box",ref_key:"textOverflowRef",ref:n,style:D({marginBottom:t.value?"25px":"0"})},[r("span",{class:"keep",ref_key:"overEllipsisRef",ref:i,title:e.text,style:D(_.value)},C(e.text),13,Ce),t.value?(l(),u("span",{key:0,class:"slot-box",ref_key:"slotRef",ref:p},[me(v.$slots,"default",{clickToggle:T,expanded:d.value},void 0,!0)],512)):k("",!0)],4))}},$e=G(Te,[["__scopeId","data-v-21df22b0"]]);const Se={class:"header"},Ue={key:0,class:"placeholder"},Pe={key:0,class:"!mt-[0.5rem] flex justify-between items-center animate__animated animate__fadeIn"},Ae={class:"cursor-pointer"},Le={key:0},Be={__name:"CommentInput",props:{inputText:{type:String,default:""},showPublishButton:{type:Boolean,default:!1},placeholder:{type:String,default:""},parent:{type:Boolean,default:!1}},emits:["update:inputText","publish"],setup(e,{expose:c,emit:d}){const t=e,n=m(""),p=m(!1),i=m(0),_=ve(()=>{d("update:inputText",n.value.innerHTML)},100),h=()=>{i.value=X()},T=()=>{p.value=!0},v=U=>{const $=U;if(i.value==n.value.innerHTML.length)n.value.innerHTML+=$;else{let P=n.value.innerHTML,A=P.slice(0,i.value),j=P.slice(i.value);n.value.innerHTML=A+$+j}i.value+=2,d("update:inputText",n.value.innerHTML)},S=()=>{d("publish"),p.value=!1},x=()=>{i.value=X(),n.value.innerHTML="",d("update:inputText",n.value.innerHTML)};return N(()=>t.showPublishButton,U=>{p.value=U}),Y(()=>{n.value&&(n.value.innerHTML=t.inputText)}),c({clear:x}),(U,$)=>{const P=he;return l(),u("div",{class:z(e.parent?"parent-input":"children-input")},[r("div",Se,[e.placeholder?(l(),u("div",Ue,"@ "+C(e.placeholder),1)):k("",!0),r("div",{ref_key:"inputCommentRef",ref:n,contenteditable:"true",class:z(["comment-content",e.parent?"parent-input-inputText":"children-input-inputText","input-inputText","!mt-[5px]"]),style:D({"--size":e.parent?"1.2rem":"1rem"}),rows:"3",cols:"20",onInput:$[0]||($[0]=A=>L(_)(U.val)),onFocus:T,onBlur:h,onClick:h,placeholder:"期待能留下你的脚印~"},null,38)]),p.value?(l(),u("div",Pe,[r("div",Ae,[B(_e,{onSelectIcon:v})]),e.inputText?(l(),u("div",Le,[B(P,{type:"danger",class:"clear-btn",onClick:x},{default:H(()=>[O("清空")]),_:1}),B(P,{type:"primary",class:"publish-btn",onClick:S},{default:H(()=>[O("发布")]),_:1})])):k("",!0)])):k("",!0)],2)}}},ue=G(Be,[["__scopeId","data-v-ffdfca56"]]);const de=e=>(se("data-v-0a72fda2"),e=e(),ae(),e),je={class:"comment-children"},Re={key:0,class:"animate__animated animate__fadeIn"},Me={class:"!w-[30px] flex justify-start"},Ne={class:"!ml-[5px]"},ze={class:"!mr-[0.5rem]"},He={key:0,class:"up"},Oe=de(()=>r("span",{class:"!mr-[1rem] content-apply"},"回复",-1)),Ee=de(()=>r("span",{class:"to-name"},"@",-1)),Ge={class:"!mr-[3px] to-name"},Fe=["innerHTML"],Ve={class:"!mt-[0.5rem]"},qe={class:"!mr-[1rem] ip"},Je=["onClick"],De={class:"!ml-[0.5rem]"},Ke=["onClick"],We=["onClick"],Qe={class:"!mt-[0.5rem]"},Xe={key:2,class:"w-[100%] flex justify-start items-center"},Ye={__name:"ChildrenItem",props:{type:{type:String,default:()=>{}},parent_id:{type:Number,default:()=>{}},id:{type:Number,default:()=>{}},parentShowApply:{type:Boolean,default:!1},authorId:{type:Number,default:()=>{}}},emits:["parentApply","refresh","changeShowApplyInput"],setup(e,{expose:c,emit:d}){const t=e,n=K(),p=F({current:1,size:5,type:"",for_id:"",parent_id:"",loading:!1,user_id:n.getUserInfo.id}),i=m([]),_=m(0),h=m(0),T=m(!1),v=F({to_name:"",to_avatar:"",to_id:""}),S=F({...v}),x=m(""),U=m(),$=m(!1),P=()=>{d("changeShowApplyInput",!1),$.value=!1,T.value=!1,Object.assign(v,S)},A=async a=>{p.loading=!0,a=="clear"&&(p.current=1),p.type=q(t.type);const f=await be(p);if(f&&f.code==0){const{list:y,total:g}=f.result;i.value=y,_.value=g-0}else I({offset:60,title:"错误提示",message:b("div",{style:"color: #f56c6c; font-weight: 600;"},f.message)});p.loading=!1},j=async(a,f)=>{let y;a.is_like?(y=await ie(a.id),await ne({for_id:a.id,type:4,user_id:n.getUserInfo.id}),y&&y.code==0&&(i.value[f].is_like=!1,i.value[f].thumbs_up--,I({offset:60,title:"提示",message:b("div",{style:"color: #7ec050; font-weight: 600;"},"已取消点赞")}))):(y=await re(a.id),await oe({for_id:a.id,type:4,user_id:n.getUserInfo.id}),y&&y.code==0&&(i.value[f].is_like=!0,i.value[f].thumbs_up++,I({offset:60,title:"提示",message:b("div",{style:"color: #7ec050; font-weight: 600;"},"点赞成功")})))},M=(a,f,y=0)=>{f=="parent"?($.value=!0,d("changeShowApplyInput",!0)):($.value=!1,h.value=y,d("changeShowApplyInput",!1)),v.parent_id=t.parent_id,v.from_id=a.from_id,v.from_avatar=a.from_avatar,v.from_name=a.from_name,x.value="",T.value=!0},s=a=>{te.confirm("确认删除此条评论吗","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then(async()=>{const f=await ce(a,t.parent_id);f&&f.code==0?(I({offset:60,title:"提示",message:b("div",{style:"color: #7ec050; font-weight: 600;"},"删除成功")}),A(),d("refresh")):I({offset:60,title:"错误提示",message:b("div",{style:"color: #f56c6c; font-weight: 600;"},f.message)})})},o=a=>{p.current=a.current,A()},w=async()=>{if(!n.getUserInfo.id){I({offset:60,title:"温馨提示",message:b("div",{style:"color: #e6c081; font-weight: 600;"},"请先登录")});return}if($.value){v.content=x.value,d("parentApply",v),P();return}const a={from_id:n.getUserInfo.id,from_avatar:n.getUserInfo.avatar,from_name:n.getUserInfo.nick_name,to_id:v.from_id,to_avatar:v.from_avatar,to_name:v.from_name,content:x.value,parent_id:v.parent_id,for_id:t.id,type:0,author_id:t.authorId};a.type=q(t.type);const f=await le(a);f.code==0?(x.value="",I({offset:60,title:"提示",message:b("div",{style:"color: #7ec050; font-weight: 600;"},"评论成功")}),P(),p.current=1,A(),U.value&&U.value.clear()):I({offset:60,title:"错误提示",message:b("div",{style:"color: #f56c6c; font-weight: 600;"},f.message)})};return N(()=>t.parent_id,a=>{Object.assign(p,{for_id:t.id,type:t.type,parent_id:a}),A()},{immediate:!0}),c({getComment:A,closeComment:P,apply:M}),(a,f)=>{const y=W;return l(),u("div",je,[i.value.length>0?(l(),u("div",Re,[(l(!0),u(V,null,Z(i.value,(g,J)=>(l(),u("div",{class:"!mt-[0.5rem] flex justify-start items-start",key:g.id},[r("div",Me,[B(y,{src:g.from_avatar,size:24,shape:"circle"},null,8,["src"])]),r("div",Ne,[r("div",null,[r("span",ze,C(g.from_name),1),g.from_id==1?(l(),u("span",He,"UP")):k("",!0),Oe,Ee,r("span",Ge,C(g.to_name)+": ",1),r("span",{class:"content",innerHTML:g.content},null,8,Fe)]),r("div",Ve,[r("span",qe,C(`IP: ${g.ipAddress}`),1),r("span",{class:z(["thumbs","!mr-[1rem]","iconfont","icon-icon1",g.is_like?"like-active":""]),onClick:Q=>j(g,J)},[r("span",De,C(g.thumbs_up),1)],10,Je),L(n).getUserInfo.id!=g.from_id?(l(),u("span",{key:0,class:"!mr-[1rem] apply cursor-pointer",onClick:Q=>M(g,"children",J)},"回复",8,Ke)):k("",!0),T.value&&!$.value&&J==h.value?(l(),u("span",{key:1,class:"!mr-[1rem] close cursor-pointer",onClick:P},"关闭")):k("",!0),L(n).getUserInfo.id==g.from_id||L(n).getUserInfo.role==1?(l(),u("span",{key:2,class:"!mr-[1rem] delete cursor-pointer",onClick:Q=>s(g.id)},"删除",8,We)):k("",!0)]),r("div",Qe,C(g.createdAt),1)])]))),128))])):k("",!0),p.loading?(l(),E(ee,{key:1,size:24})):k("",!0),T.value?(l(),u("div",Xe,[B(ue,{ref_key:"commentInputRef",ref:U,inputText:x.value,"onUpdate:inputText":f[0]||(f[0]=g=>x.value=g),placeholder:v.from_name,"show-publish-button":!1,onPublish:w},null,8,["inputText","placeholder"])])):k("",!0),_.value>0?(l(),E(ke,{key:3,class:"animate__animated animate__fadeIn",size:p.size,current:p.current,layout:"prev, pager, next",total:_.value,onPagination:o},null,8,["size","current","total"])):k("",!0)])}}},Ze=G(Ye,[["__scopeId","data-v-0a72fda2"]]);const et={class:"comment-parent"},tt={class:"flex justify-start items-start"},st={class:"avatar-box"},at={class:"right !w-[100%]"},nt={class:"cursor-pointer"},ot={key:0,class:"up"},lt={id:"comment-content",class:"!mt-[1rem]"},rt=["innerHTML"],it=["onClick"],ct={class:"!mt-[0.5rem]"},ut={class:"!mr-[1rem] ip"},dt=["onClick"],pt={class:"!ml-[0.5rem]"},ft=["onClick"],mt=["onClick"],_t=["onClick"],vt={class:"!mt-[0.5rem]"},ht={key:3,class:"h-[48px]"},yt={__name:"ParentItem",props:{active:{type:String,default:"hot"},type:{type:String,default:()=>{}},id:{type:Number,default:()=>{}},authorId:{type:Number,default:()=>{}}},emits:["refresh"],setup(e,{expose:c,emit:d}){const t=e,n=K(),p=m(),i=F({current:1,size:5,type:0,for_id:0,order:"",user_id:n.getUserInfo.id,loading:!1}),_=m([]),h=m(0),T=async s=>{i.loading=!0,s=="clear"&&(i.current=1),i.type=q(t.type);const o=await Ie(i);if(o&&o.code==0){const{list:w,total:a}=o.result;w.forEach(f=>{f.showApplyInput=!1}),_.value=i.current==1?w:_.value.concat(w),h.value=a-0}else I({offset:60,title:"错误提示",message:b("div",{style:"color: #f56c6c; font-weight: 600;"},o.message)});i.loading=!1},v=()=>{i.current++,T()},S=m(0),x=async(s,o)=>{let w;s.is_like?(w=await ie(s.id),await ne({for_id:s.id,type:4,user_id:n.getUserInfo.id}),w&&w.code==0&&(_.value[o].is_like=!1,_.value[o].thumbs_up--,I({offset:60,title:"提示",message:b("div",{style:"color: #7ec050; font-weight: 600;"},"已取消点赞")}))):(w=await re(s.id),await oe({for_id:s.id,type:4,user_id:n.getUserInfo.id}),w&&w.code==0&&(_.value[o].is_like=!0,_.value[o].thumbs_up++,I({offset:60,title:"提示",message:b("div",{style:"color: #7ec050; font-weight: 600;"},"点赞成功")})))},U=(s,o)=>{_.value[o].showApplyInput=!0,S.value=o,p.value[o].apply(s,"parent")},$=s=>{_.value[s].showApplyInput=!1,S.value=0,p.value[s].closeComment()},P=(s,o)=>{_.value[o].showApplyInput=s},A=()=>{_.value.length&&p.value.forEach(s=>{s.closeComment()})},j=s=>{te.confirm("确认删除此条评论吗？子级评论也会被删除哦","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then(async()=>{const o=await ce(s);o&&o.code==0?(I({offset:60,title:"提示",message:b("div",{style:"color: #7ec050; font-weight: 600;"},"删除成功")}),T("clear"),d("refresh")):I({offset:60,title:"错误提示",message:b("div",{style:"color: #f56c6c; font-weight: 600;"},o.message)})})},M=async s=>{const o={from_id:n.getUserInfo.id,from_avatar:n.getUserInfo.avatar,from_name:n.getUserInfo.nick_name,to_id:s.from_id,to_avatar:s.from_avatar,to_name:s.from_name,content:s.content,parent_id:s.parent_id,for_id:t.id,author_id:t.authorId};switch(t.type){case"article":o.type=1;break;case"talk":o.type=2;break;case"message":o.type=3;break}const w=await le(o);w.code==0?(I({offset:60,title:"提示",message:b("div",{style:"color: #7ec050; font-weight: 600;"},"评论成功")}),i.current=1,p.value[S.value].getComment("clear"),S.value=0,d("refresh")):I({offset:60,title:"错误提示",message:b("div",{style:"color: #f56c6c; font-weight: 600;"},w.message)})};return N(()=>t.type,s=>{Object.assign(i,{for_id:t.id,type:s,order:t.active}),T()},{immediate:!0}),N(()=>t.active,s=>{Object.assign(i,{order:s,current:1}),T()},{}),c({getComment:T,closeComment:A}),(s,o)=>{const w=W;return l(),u("div",et,[_.value.length?(l(!0),u(V,{key:0},Z(_.value,(a,f)=>(l(),u("div",{class:"!mt-[0.5rem] animate__animated animate__fadeIn",key:f},[r("div",tt,[r("div",st,[B(w,{class:"avatar",src:a.from_avatar},{default:H(()=>[O(C(a.from_name),1)]),_:2},1032,["src"])]),r("div",at,[r("div",nt,[O(C(a.from_name)+" ",1),a.from_id==1?(l(),u("span",ot,"UP")):k("",!0)]),r("div",lt,[L(ye)(a.content)?(l(),u("span",{key:0,innerHTML:a.content},null,8,rt)):(l(),E($e,{class:"content",key:a.id,text:a.content,maxLines:3,"font-size":16},{default:H(({clickToggle:y,expanded:g})=>[r("span",{onClick:y,class:"btn"},C(g?"收起":"展开"),9,it)]),_:2},1032,["text"]))]),r("div",ct,[r("span",ut,C(`IP: ${a.ipAddress}`),1),r("span",{class:z(["thumbs","!mr-[1rem]","iconfont","icon-icon1",a.is_like?"like-active":""]),onClick:y=>x(a,f)},[r("span",pt,C(a.thumbs_up),1)],10,dt),r("span",{class:"!mr-[1rem] apply cursor-pointer",onClick:y=>U(a,f)},"回复",8,ft),a.showApplyInput?(l(),u("span",{key:0,class:"!mr-[1rem] close cursor-pointer",onClick:y=>$(f)},"关闭",8,mt)):k("",!0),L(n).getUserInfo.id==a.from_id||L(n).getUserInfo.role==1?(l(),u("span",{key:1,class:"!mr-[1rem] delete cursor-pointer",onClick:y=>j(a.id)},"删除",8,_t)):k("",!0)]),r("div",vt,C(a.createdAt),1),B(Ze,{class:"!mt-[1.5rem]",ref_for:!0,ref_key:"childrenRef",ref:p,type:t.type,id:e.id,parent_id:a.id,"author-id":e.authorId,onParentApply:M,onRefresh:o[0]||(o[0]=y=>d("refresh")),onChangeShowApplyInput:y=>P(y,f)},null,8,["type","id","parent_id","author-id","onChangeShowApplyInput"])])])]))),128)):k("",!0),i.loading?(l(),E(ee,{key:1,size:32})):h.value>_.value.length?(l(),u("div",{key:2,class:"show-more",onClick:v}," 展开更多 ")):(l(),u("div",ht))])}}},gt=G(yt,[["__scopeId","data-v-7484da38"]]);const kt=e=>(se("data-v-9ddddd8c"),e=e(),ae(),e),wt={class:"comment"},It={class:"comment-header"},bt={class:"flex justify-start items-center"},xt={key:1,class:"flex items-center"},Ct=kt(()=>r("span",{class:"comment-tab"},"|",-1)),Tt={key:0},$t={id:"commentInput",class:"!mt-[1rem] w-[100%] flex justify-start items-start"},St={class:"avatar-box"},Ut={class:"!w-[100%] !ml-[10px]"},Pt={class:"comment-list"},At={__name:"Comment",props:{type:{type:String,default:()=>{}},id:{type:Number,default:()=>{}},authorId:{type:Number,default:()=>{}},expand:{type:Boolean,default:!1},isShowToggle:{type:Boolean,default:!0}},emits:["refresh"],setup(e,{expose:c,emit:d}){const t=e,n=K(),p=m("hot"),i=m(0),_=m(null),h=m(!1),T=m(!1),v=m(),S=m(""),x=()=>{h.value=!h.value},U=s=>{p.value=s},$=()=>{n.getUserInfo.id||n.setShowLogin(!0)},P=async()=>{if(!n.getUserInfo.id){I({offset:60,title:"温馨提示",message:b("div",{style:"color: #e6c081; font-weight: 600;"},"请先登录")});return}const s={from_id:n.getUserInfo.id,from_avatar:n.getUserInfo.avatar,from_name:n.getUserInfo.nick_name,content:S.value,for_id:t.id,type:0,author_id:t.authorId};switch(t.type){case"article":s.type=1;break;case"talk":s.type=2;break;case"message":s.type=3;break}const o=await we(s);o.code==0?(S.value="",I({offset:60,title:"提示",message:b("div",{style:"color: #7ec050; font-weight: 600;"},"评论成功")}),_.value&&_.value.getComment("clear"),h.value=!0,T.value=!1,v.value&&v.value.clear(),M()):I({offset:60,title:"错误提示",message:b("div",{style:"color: #f56c6c; font-weight: 600;"},o.message)})},A=s=>{i.value=s},j=async()=>{const s=await xe({type:q(t.type),for_id:t.id});if(s&&s.code==0){const o=s.result;A(o-0)}else I({offset:60,title:"错误提示",message:b("div",{style:"color: #f56c6c; font-weight: 600;"},s.message)})},M=()=>{j(),d("refresh")};return N(()=>t.expand,s=>{h.value=s},{immediate:!0}),Y(()=>{j()}),c({toggleExpand:x}),(s,o)=>{const w=W;return l(),u("div",wt,[r("div",It,[r("div",bt,[i.value?(l(),u("span",{key:0,class:"total-value",onClick:x}," 评论 "+C(L(ge)(i.value)),1)):k("",!0),i.value&&h.value?(l(),u("div",xt,[r("span",{class:z(["comment-tab",p.value=="hot"?"active-order":""]),onClick:o[0]||(o[0]=a=>U("hot"))},"最热",2),Ct,r("span",{class:z(["comment-tab",p.value=="new"?"active-order":""]),onClick:o[1]||(o[1]=a=>U("new"))},"最新",2)])):k("",!0)]),e.isShowToggle?(l(),u(V,{key:0},[i.value?(l(),u("span",{key:0,class:"more",onClick:x},C(h.value?"收起":"查看更多"),1)):(l(),u("span",{key:1,class:"more",onClick:x},C(h.value?"取消发布":"求评论呀~"),1))],64)):!e.isShowToggle&&h.value?(l(),u(V,{key:1},[i.value?(l(),u("span",{key:0,class:"more",onClick:x}," 收起")):(l(),u("span",{key:1,class:"more",onClick:x}," 取消发布 "))],64)):k("",!0)]),h.value?(l(),u("div",Tt,[r("div",$t,[r("div",St,[B(w,{class:"avatar",src:L(n).getUserInfo.avatar,onClick:$},{default:H(()=>[O(C(L(n).getUserInfo.nick_name||"登录"),1)]),_:1},8,["src"])]),r("div",Ut,[B(ue,{ref_key:"commentInputRef",ref:v,inputText:S.value,"onUpdate:inputText":o[2]||(o[2]=a=>S.value=a),"show-publish-button":!1,parent:!0,onPublish:P},null,8,["inputText"])])]),r("div",Pt,[h.value?(l(),E(gt,{key:0,ref_key:"parentItemRef",ref:_,active:p.value,type:e.type,id:e.id,"author-id":e.authorId,onRefresh:M},null,8,["active","type","id","author-id"])):k("",!0)])])):k("",!0)])}}},Rt=G(At,[["__scopeId","data-v-9ddddd8c"]]);export{$e as T,Rt as _};
