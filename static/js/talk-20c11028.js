import{a2 as I,_ as O,K as H,B as v,L as J,I as K,af as Q,r as W,c as n,b as s,a as e,e as p,F as u,E as X,o,f as k,ay as Y,k as B,t as f,j as R,l as Z,az as ee,h as N,d as te,J as se,aq as q,T as G,G as ie,q as ae,s as oe,aA as ne}from"./index-7cf17b50.js";import{E as le}from"./el-skeleton-item-7b233842.js";import{_ as ce}from"./index-d6d7d3f9.js";import{c as re,a as _e}from"./like-f669dd3b.js";import{T as de,_ as pe}from"./Comment-a9548d85.js";import{_ as l}from"./skeleton-item-937e2cee.js";import"./index-4c28875d.js";import"./pagination-488bf88a.js";import"./el-select-a54a04c3.js";import"./strings-111307c0.js";const he=h=>new Promise((r,a)=>{I.post("/api/talk/blogGetTalkList",h).then(c=>{r(c)})}),ue=h=>new Promise((r,a)=>{I.put("/api/talk/like/"+h,{}).then(c=>{r(c)})}),me=h=>new Promise((r,a)=>{I.put("/api/talk/cancelLike/"+h,{}).then(c=>{r(c)})});const ve={class:"talk center_box"},fe={class:"w-[70%] !ml-[10px]"},ge={class:"flex justify-between !w-[40%]"},xe={class:"flex w-[20%]"},we={class:"w-[100%] !ml-[10px]"},ke={class:"flex justify-between !w-[80%]"},ye={class:"flex w-[20%]"},Le={class:"talk-card__item animate__animated animate__fadeIn"},be={class:"left"},Ie={class:"w-[100%]"},Ce={class:"right"},je={class:"right-top relative"},Ee={key:0,class:"iconfont icon-zhiding"},Te={class:"nick-name"},ze=["onClick"],Ae={key:0,class:"right-bottom"},Be={class:"w-[100%] h-[100%] grid place-items-center"},Re={key:1,class:"right-bottom-one"},Ne={class:"flex justify-center items-center w-[100%] h-[100%] overflow-hidden"},qe={class:"w-[100%] h-[100%] grid place-items-center"},Ge={class:"like flex justify-between items-center !mt-[15px]"},Pe={class:"time"},Se=["onClick"],Ue=["onClick"],Ve={class:"!mt-[10px]"},De={class:"observer"},$e={__name:"talk",setup(h){const r=H(),a=v([]),c=v(0),g=v(!1),y=v(!1),C=v(null);let m,L;const x=J({current:1,size:5,user_id:r.getUserInfo.id}),P=()=>{L=document.querySelector(".observer"),m=new IntersectionObserver(i=>{i.forEach(async _=>{_.isIntersecting&&_.intersectionRatio>0&&c.value>a.value.length&&(x.current++,j())})},{rootMargin:"0px 0px 300px 0px"}),m.observe(L)},j=async()=>{try{x.current==1?g.value=!0:y.value=!0;let i=await he(x);i.code==0&&(a.value=x.current==1?i.result.list:a.value.concat(i.result.list),c.value=i.result.total)}finally{g.value=!1,y.value=!1}},S=async(i,_)=>{i.is_like?(await me(i.id)).code==0&&(await re({for_id:i.id,type:2,user_id:r.getUserInfo.id}),a.value[_].is_like=!1,a.value[_].like_times--,q({offset:60,title:"提示",message:G("div",{style:"color: #7ec050; font-weight: 600;"},"已取消点赞")})):(await ue(i.id)).code==0&&(await _e({for_id:i.id,type:2,user_id:r.getUserInfo.id}),a.value[_].is_like=!0,a.value[_].like_times++,q({offset:60,title:"提示",message:G("div",{style:"color: #7ec050; font-weight: 600;"},"点赞成功")}))},U=i=>{C.value[i].toggleExpand()};return K(async()=>{await j(),a.value.length<c.value&&P()}),Q(()=>{m&&m.unobserve(L),m=null}),(i,_)=>{const b=ce,V=ie,E=ae,T=oe,D=ne,$=le,F=X,z=W("image");return o(),n(u,null,[s(b,{loading:g.value},null,8,["loading"]),e("div",ve,[s(F,{class:"talk-card"},{default:p(()=>[s($,{loading:g.value,style:{height:"100%"},animated:""},{template:p(()=>[(o(),n(u,null,k(3,t=>e("div",{class:"pc-skeleton flex justify-start w-[100%] !mt-[30px]",key:t},[s(l,{variant:"text",width:"80px",height:"80px"}),e("div",fe,[s(l,{variant:"text",width:"40%",height:"20px"}),s(l,{variant:"image",width:"40%",height:"180px",top:"10px"}),e("div",ge,[s(l,{variant:"text",width:"10%",height:"20px",top:"10px"}),e("div",xe,[s(l,{variant:"text",width:"50%",height:"20px",top:"10px"}),s(l,{variant:"text",width:"50%",height:"20px",top:"10px",left:"10px"})])])])])),64)),(o(),n(u,null,k(3,t=>e("div",{class:"mobile-skeleton flex justify-start w-[100%] !mt-[30px]",key:t},[s(l,{variant:"text",width:"80px",height:"80px"}),e("div",we,[s(l,{variant:"text",width:"80%",height:"20px"}),s(l,{variant:"image",width:"80%",height:"180px",top:"10px"}),e("div",ke,[s(l,{variant:"text",width:"10%",height:"20px",top:"10px"}),e("div",ye,[s(l,{variant:"text",width:"50%",height:"20px",top:"10px"}),s(l,{variant:"text",width:"50%",height:"20px",top:"10px",left:"10px"})])])])])),64))]),default:p(()=>[s(Y,{name:"scroll-list",tag:"div"},{default:p(()=>[(o(!0),n(u,null,k(a.value,(t,A)=>(o(),n("div",{class:"w-[100%] talk-item-line",key:t.id},[e("div",Le,[e("div",be,[s(V,{class:"left-avatar",src:t.avatar,shape:"square"},null,8,["src"])]),e("div",Ie,[e("div",Ce,[e("div",je,[t.is_top==1?(o(),n("i",Ee)):B("",!0),e("span",Te,f(t.nick_name),1),s(de,{class:"content",text:t.content,maxLines:3,"font-size":14},{default:p(({clickToggle:d,expanded:w})=>[e("span",{onClick:d,class:"btn"},f(w?"收起":"展开"),9,ze)]),_:2},1032,["text"])]),Array.isArray(t.talkImgList)&&t.talkImgList.length>1?(o(),n("div",Ae,[(o(!0),n(u,null,k(t.talkImgList,(d,w)=>R((o(),n("div",{class:"image",key:w},[s(T,{class:"w-[100%] h-[100%]",src:d,loading:"lazy","preview-teleported":"","initial-index":w,fit:"cover","preview-src-list":t.talkImgList.map(M=>M)},{error:p(()=>[e("div",Be,[s(E,{name:"image404",width:5,height:5})])]),_:2},1032,["src","initial-index","preview-src-list"])])),[[z,d]])),128))])):Array.isArray(t.talkImgList)&&t.talkImgList.length==1?(o(),n("div",Re,[R((o(),n("div",Ne,[s(T,{class:"w-[100%] h-[100%]",src:t.talkImgList[0],loading:"lazy","preview-teleported":"","initial-index":0,fit:"cover","preview-src-list":t.talkImgList.map(d=>d)},{error:p(()=>[e("div",qe,[s(E,{name:"image404",width:8,height:8})])]),_:2},1032,["src","preview-src-list"])])),[[z,t.talkImgList[0]]])])):B("",!0),e("div",Ge,[e("div",Pe,f(Z(ee)(t.createdAt))+"前",1),e("div",null,[e("i",{class:"comment-icon iconfont icon-pinglun",onClick:d=>U(A)},null,8,Se),e("i",{class:N(["iconfont","icon-icon1","!ml-[10px]",t.is_like?"is-like":""]),onClick:d=>S(t,A)},null,10,Ue),e("span",{class:N([t.is_like?"is-like":"","!ml-[5px]"])},f(t.like_times),3)])]),e("div",Ve,[s(pe,{ref_for:!0,ref_key:"talkCommentRef",ref:C,class:"w-[100%]",type:"talk",id:t.id,"author-id":t.user_id,"is-show-toggle":!1},null,8,["id","author-id"])])])])])]))),128))]),_:1}),e("div",De,[y.value?(o(),te(D,{key:0,size:32})):(o(),n(u,{key:1},[se(f(a.value.length>=c.value?"已经到底了~":"下拉加载更多～"),1)],64))])]),_:1},8,["loading"])]),_:1})])],64)}}},Ze=O($e,[["__scopeId","data-v-3b9a10f9"]]);export{Ze as default};
